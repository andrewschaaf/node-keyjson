(function(){var o,l,k,j,m,p,n,q;q=function(a){var e,b,c;if(a>=0){if(a<128)b=1;else if(a<16384)b=2;else if(a<2097152)b=3;else if(a<268435456)b=4;else if(a<34359738368)b=5;else if(a<4398046511104)b=6;else if(a<562949953421312)b=7;else if(a<72057594037927936)b=8;else throw{name:"ValueError",message:"Number out of bounds"};e=191+b;a=a}else{if(a>-128)b=1;else if(a>-16384)b=2;else if(a>-2097152)b=3;else if(a>-268435456)b=4;else if(a>-34359738368)b=5;else if(a>-4398046511104)b=6;else if(a>-562949953421312)b=
7;else if(a>-72057594037927936)b=8;else throw{name:"ValueError",message:"Number out of bounds"};e=192-b;a=a+Math.pow(128,b)-1}c=new Buffer(b+1);c[0]=e;e=7*(b-1);var d=1;for(b=b+1;d<b;d+=1){c[d]=128+(a>>e&127);e-=7}return c};o=function(a){var e,b,c;c=a.length-1;e=0;b=7*(c-1);for(var d=0;d<c;d+=1){e|=a[d+1]-128<<b;b-=7}return a[0]>=192?e:e-(Math.pow(128,c)-1)};p=function(a,e){var b,c;c=[];for(var d=b=0,f=a.length;d<f;d+=1)if(a[d]===e){c.push(a.slice(b,d));b=d+1}c.push(a.slice(b,a.length));return c};
n=function(a,e,b){var c,d;c=a.length;var f;d=0;for(var g=a.length;d<g;d+=1){f=a[d];c+=f.length}d=new Buffer(c);d[0]=b;b=1;g=0;for(var h=a.length;g<h;g+=1){f=a[g];f.copy(d,b,0);b+=f.length+1;if(b<c)d[b-1]=e}return d};j=function(a,e){var b,c;if(a===null)return new Buffer("1");if(a===false)return new Buffer("2");if(a===true)return new Buffer("3");b=typeof a;if(b==="string")return new Buffer("4"+a);if(b==="number"){if(!(isFinite(a)&&a%1===0))throw{name:"ValueError",message:"keyjson doesn't support non-integer numbers"};
return q(a)}if(e)throw{name:"ValueError",message:"keyjson doesn't support sub-structures"};if(a instanceof Array){b=function(){for(var h=[],i=0,r=a.length;i<r;i+=1)h.push(j(a[i]));return h}.call(this);return n(b,0,53)}else{b=[];for(c in a)a.hasOwnProperty(c)&&b.push([j(c),c]);b.sort();c=[];for(var d,f=0,g=b.length;f<g;f+=1){d=b[f];c.push(d[0]);c.push(j(a[d[1]]))}return n(c,0,54)}throw{name:"ValueError",message:"Unsupported prefix"};};k=function(a){var e,b;if(!a.length)throw{name:"ValueError",message:"Blank input"};
b=a[0];if(b>128)return o(a);if(b===49)return null;if(b===50)return false;if(b===51)return true;e=a.slice(1,a.length);if(b===52)return e.toString("utf-8");a=function(){for(var f=[],g=p(e,0),h=0,i=g.length;h<i;h+=1)f.push(k(g[h]));return f}.call(this);if(b===53)return a;if(b===54){b={};for(var c=0,d=a.length;c<d;c+=1)b[a[2*c]]=a[2*c+1];return b}throw{name:"ValueError",message:"Unknown prefix."};};l=function(a){var e,b,c,d;d=[];e=a.length;for(c=0;c<e;){b=(a[c]||0)<<16|(a[c+1]||0)<<8|(a[c+2]||0);c+=3;
d.push("()0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!".charAt(b>>18&63)+"()0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!".charAt(b>>12&63)+"()0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!".charAt(b>>6&63)+"()0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!".charAt(b&63))}a=d.join("");e=e%3;if(e===1)a=a.slice(0,-2)+"!!";else if(e===2)a=a.slice(0,-1)+"!";return a};m=function(a){var e,b,c,d,f,g,h,i;if(a instanceof Buffer)a=a.toString("utf-8");
g=[];i=a.length;for(h=0;h<i;){b="()0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!".indexOf(a[h]);d="()0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!".indexOf(a[h+1]);c="()0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!".indexOf(a[h+2]);f="()0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!".indexOf(a[h+3]);h+=4;e=(c>>6)+(f>>6);b=b<<18|d<<12|c%64<<6|f%64;g.push(b>>16&255);e<2&&g.push(b>>8&255);e<1&&g.push(b&255)}return new Buffer(g)};
exports.stringify=j;exports.parse=k;exports.b64encode=l;exports.b64decode=m;exports.stringify64=function(a){return l(j(a))};exports.parse64=function(a){return k(m(a))}})();
